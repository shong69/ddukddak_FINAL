<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ddukddak.partner.model.mapper.InteriorMapper">
	
	<resultMap type="Project" id="project_rm">
	
		<!-- id 태그 : PK 역할을 하는 컬럼, 필드를 작성하는 태그 -->
		<id property="projectNo" column="PROJECT_NO"/>
		
		<!-- 
			<< collection 태그 >>
			select로 조회된 결과를 컬렉션(List)에 담아
			지정된 필드에 세팅
			
			property : List를 담을 DTO의 필드명
			select : 실행할 select의 id
			column : 조회 결과 중 지정된 컬럼의 값을 파라미터로 전달
			javaType : List(컬렉션)의 타입을 지정
			ofType : List(컬렉션)의 제네릭(타입 제한) 지정
		-->
		
		<!-- 해당 포트폴리오 이미지 목록 조회 후 필드에 저장 -->
		<collection property="imageList" 
					select="selectImageList"
					column="PROJECT_NO"
					javaType="java.util.ArrayList"
					ofType="ProjectImg"/>
	
	</resultMap>
	
	<!-- 시공사 리스트 조회 -->
	<select id="selectIneriorList">
		SELECT PARTNER_NO, PARTNER_TEL, PARTNER_BUSINESS_NAME, PORTFOLIO_NO, HOME_LINK
		FROM PARTNER 
		LEFT JOIN PORTFOLIO USING (PARTNER_NO)
		WHERE PARTNER_TYPE = 1
		AND PARTNER_DEL_FL = 'N'
    <!-- AND MAIN_PROJECT_FL = 'Y' -->
	</select>
	
	<!-- 포트폴리오 조회 -->
    <select id="selectPortfolio" parameterType="int">
        SELECT * FROM PORTFOLIO WHERE PORTFOLIO_NO = #{portfolioNo}
    </select>
    
    <select id="selectMain">
    	SELECT PARTNER_NO, PARTNER_TEL, PARTNER_BUSINESS_NAME, PORTFOLIO_NO, PROJECT_NAME, HOME_LINK, 
		PORTFOLIO_DETAIL, HOUSING_TYPE, WORK_FORM, WORK_AREA, PROFILE_IMG, 	
		CONSTRUCTION_COST, REGION, CONSTRUCTION_YEAR, FAMILY_SIZE, PROJECT_CONTENT,
		MAIN_PROJECT_FL 
		FROM PARTNER 
		NATURAL JOIN PORTFOLIO 
		NATURAL JOIN PROJECT_INFO 
		NATURAL JOIN PROJECT
		WHERE PARTNER_TYPE = 1 AND MAIN_PROJECT_FL = 'Y'
		AND PORTFOLIO_NO = #{portfolioNo}
    </select>
    
    <select id="selectPortfolioList">
    	SELECT PARTNER_NO, PARTNER_TEL, PARTNER_BUSINESS_NAME, PORTFOLIO_NO, PROJECT_NAME, HOME_LINK, 
		PORTFOLIO_DETAIL, HOUSING_TYPE, WORK_FORM, WORK_AREA, PROFILE_IMG, 	
		CONSTRUCTION_COST, REGION, CONSTRUCTION_YEAR, FAMILY_SIZE, PROJECT_CONTENT,
		MAIN_PROJECT_FL FROM PARTNER NATURAL JOIN 
		PORTFOLIO NATURAL JOIN PROJECT_INFO 
		NATURAL JOIN PROJECT
		WHERE PARTNER_TYPE = 1 AND MAIN_PROJECT_FL = 'N'
		AND PORTFOLIO_NO = #{portfolioNo}
    </select>
    
    <!-- 상세조회한 게시글의 이미지 리스트 조회 -->
	<select id="selectImageList" resultType="ProjectImg">
		SELECT * FROM "UPLOAD_FILE" 
		WHERE PROJECT_NO = #{projectNo}
		ORDER BY UPLOAD_IMG_ORDER
	</select>
	
</mapper>
