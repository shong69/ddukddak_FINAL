<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ddukddak.manager.model.mapper.ManagerMapper">

	<!-- 파트너 수 조회 -->
	<select id="getListCount">
		SELECT COUNT(*)
		FROM "PARTNER"
		WHERE PARTNER_DEL_FL = 'W'
		AND PARTNER_PASS = 0
	</select>
	
	<!-- 파트너 목록 조회 -->
	<select id="selectPassList">
		SELECT PARTNER_NO, PARTNER_ID, PARTNER_BUSINESS_NAME, PARTNER_BUSINESS_NUM,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, PARTNER_TEL
		FROM "PARTNER"
		WHERE PARTNER_DEL_FL = 'W'
		AND PARTNER_PASS = 0
		ORDER BY PARTNER_NO DESC
	</select>
	
	<!-- 파트너 가입 승인 업데이트 -->
	<update id="passConfirm">
		UPDATE "PARTNER" SET
		PARTNER_DEL_FL = 'N',
		PARTNER_PASS = 1,
		ENROLL_DATE = SYSDATE
		WHERE PARTNER_NO = #{partnerNo}
		AND PARTNER_DEL_FL = 'W'
	</update>
	
	<!-- 파트너 가입 거절 업데이트 -->
	<update id="passRefuse">
		UPDATE "PARTNER" SET
		PARTNER_DEL_FL = 'Y',
		PARTNER_PASS = -1,
		ENROLL_DATE = SYSDATE
		WHERE PARTNER_NO = #{partnerNo}
		AND PARTNER_DEL_FL = 'W'
	</update>
	
	<!-- 회원 수 조회 -->
	<select id="getMemberListCount">
		SELECT COUNT(*)
		FROM "MEMBER"
		WHERE AUTHORITY = 1
	</select>
		
	<!-- 회원 목록 조회 -->
	<select id="selectMemberList">
		SELECT MEMBER_NO, MEMBER_ID, MEMBER_EMAIL, MEMBER_TEL, PROFILE_IMG,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, MEMBER_DEL_FL
		FROM "MEMBER"
		WHERE AUTHORITY = 1
		ORDER BY MEMBER_NO DESC
	</select>
	
	<!-- 회원 탈퇴 처리 -->
	<update id="memberDelete">
		UPDATE "MEMBER" SET
		MEMBER_DEL_FL = 'Y'
		WHERE MEMBER_NO = #{memberNo}
	</update>
	
	<!-- 파트너 수 조회 -->
	<select id="getPartnerListCount">
		SELECT COUNT(*)
		FROM "PARTNER"
		ORDER BY PARTNER_NO DESC
	</select>
	
	<!-- 파트너 목록 조회 -->
	<select id="selectPartnerList">
		SELECT PARTNER_NO, PARTNER_ID, PARTNER_BUSINESS_NAME, PARTNER_BUSINESS_NUM,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, PARTNER_TEL, PARTNER_DEL_FL
		FROM "PARTNER"
		ORDER BY PARTNER_NO DESC
	</select>
	
	<!-- 파트너 탈퇴 처리 -->
	<update id="partnerDelete">
		UPDATE "PARTNER" SET
		PARTNER_DEL_FL = 'Y'
		WHERE PARTNER_NO = #{partnerNo}
	</update>
	
	
	<!-- 신고 목록 개수 조회 -->
	<select id="getReportCount">
		SELECT COUNT(*) FROM "REPORT"
	</select>
	
	<!-- 신고 내역 조회 -->
	<select id="selectReportList">
		SELECT 
	    REPORT_NO,
	    (SELECT MEMBER_ID 
	     FROM "MEMBER" m 
	     LEFT JOIN "REPORT" r 
	     ON m.MEMBER_NO = r.REPORTED_MEMBER_NO 
	     WHERE r.REPORT_NO = main.REPORT_NO) AS REPORTED_MEMBER_ID,
	    (SELECT MEMBER_ID 
	     FROM "MEMBER" m 
	     LEFT JOIN "REPORT" r 
	     ON m.MEMBER_NO = r.MEMBER_NO 
	     WHERE r.REPORT_NO = main.REPORT_NO) AS MEMBER_ID,
	    REPORT_REASON, 
	    TO_CHAR(REPORT_DATE, 'YYYY-MM-DD') AS REPORT_DATE, 
	    BOARD_NO
		FROM 
	    "REPORT" main
	    ORDER BY REPORT_NO DESC
	</select>

	
	<!-- 결제 내역 수 조회 -->
	<select id="getPaymentCount">
		SELECT COUNT(*)
		FROM "PAYMENT"
	</select>
	
	<!-- 결제 내역 목록 조회 -->
	<select id="selectPaymentList">
		SELECT 
			PAYMENT_NO,
			MERCHANT_UID,
			BUYER_NAME,
			AMOUNT,
			STATUS,
			PG_PROVIDER,
			PAY_METHOD,
			STARTED_AT
		FROM "PAYMENT"
		ORDER BY STARTED_AT DESC
	</select>
	
	<!-- 정렬에 맞는 회원 수 조회 -->
	<select id="getSortListCount">
		SELECT COUNT(*)
		FROM "MEMBER"
		WHERE AUTHORITY = 1
		<choose>
			<!-- 정렬 N : 활동중 -->
			<when test='sort == "n"'>
				AND MEMBER_DEL_FL = 'N'
			</when>
			
			<!-- 정렬 Y: 탈퇴  -->	
			<when test='sort == "y"'>
				AND MEMBER_DEL_FL = 'Y'
			</when>
		</choose>
	</select>
	
	<!-- 검색 x - 회원 정렬 목록 -->
	<select id="selectMemberSortList">
		SELECT MEMBER_NO, MEMBER_ID, MEMBER_EMAIL, MEMBER_TEL, PROFILE_IMG,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, MEMBER_DEL_FL
		FROM "MEMBER"
		WHERE AUTHORITY = 1
		<choose>
			<!-- 정렬 N : 활동중 -->
			<when test='sort == "n"'>
				AND MEMBER_DEL_FL = 'N'
			</when>
			
			<!-- 정렬 Y: 탈퇴  -->	
			<when test='sort == "y"'>
				AND MEMBER_DEL_FL = 'Y'
			</when>
			
		</choose>
		ORDER BY MEMBER_NO DESC
	</select>
	
	<!-- 검색 O - 전체 회원 수 -->
	<select id="getSerchListCount">
		SELECT COUNT(*)
		FROM "MEMBER"
		WHERE AUTHORITY = 1
		AND MEMBER_EMAIL LIKE '%' || #{search} || '%'
	</select>
	
	<!-- 검색 O 전체 회원 목록  -->
	<select id="selectSearchMember">
		SELECT MEMBER_NO, MEMBER_ID, MEMBER_EMAIL, MEMBER_TEL, PROFILE_IMG,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, MEMBER_DEL_FL
		FROM "MEMBER"
		WHERE AUTHORITY = 1
		AND MEMBER_EMAIL LIKE '%' || #{search} || '%'
		ORDER BY MEMBER_NO DESC
	</select>
	
	<!-- 검색 + 정렬 회원 수 -->
	<select id="getSortSerchListCount">
		SELECT COUNT(*)
		FROM "MEMBER"
		WHERE AUTHORITY = 1
		AND MEMBER_EMAIL LIKE '%' || #{search} || '%'
		<choose>
			<!-- 정렬 N : 활동중 -->
			<when test='sort == "n"'>
				AND MEMBER_DEL_FL = 'N'
			</when>
			
			<!-- 정렬 Y: 탈퇴  -->	
			<when test='sort == "y"'>
				AND MEMBER_DEL_FL = 'Y'
			</when>
		</choose>
	</select>
	
	<!-- 검색 + 정렬 회원 목록 -->
	<select id="selectSortSearchMember">
		SELECT MEMBER_NO, MEMBER_ID, MEMBER_EMAIL, MEMBER_TEL, PROFILE_IMG,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, MEMBER_DEL_FL
		FROM "MEMBER"
		WHERE AUTHORITY = 1
		AND MEMBER_EMAIL LIKE '%' || #{search} || '%'
		<choose>
			<!-- 정렬 N : 활동중 -->
			<when test='sort == "n"'>
				AND MEMBER_DEL_FL = 'N'
			</when>
			
			<!-- 정렬 Y: 탈퇴  -->	
			<when test='sort == "y"'>
				AND MEMBER_DEL_FL = 'Y'
			</when>
		</choose>
		ORDER BY MEMBER_NO DESC
	</select>
	
	
	
	<!-- 파트너 수(정렬) -->
	<select id="getSortListCountP">
		SELECT COUNT(*)
		FROM "PARTNER"
		<choose>
			<!-- 정렬 N : 활동중 -->
			<when test='sort == "n"'>
				AND PARTNER_DEL_FL = 'N'
			</when>
			
			<!-- 정렬 Y: 탈퇴  -->	
			<when test='sort == "y"'>
				AND PARTNER_DEL_FL = 'Y'
			</when>
		</choose>
	</select>
	
	<!-- 파트너 목록(정렬) -->
	<select id="selectPartnerSortList">
		SELECT PARTNER_NO, PARTNER_ID, PARTNER_BUSINESS_NAME, PARTNER_BUSINESS_NUM,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, PARTNER_TEL, PARTNER_DEL_FL
		FROM "PARTNER"
		<choose>
			<!-- 정렬 N : 활동중 -->
			<when test='sort == "n"'>
				AND PARTNER_DEL_FL = 'N'
			</when>
			
			<!-- 정렬 Y: 탈퇴  -->	
			<when test='sort == "y"'>
				AND PARTNER_DEL_FL = 'Y'
			</when>
		</choose>
		ORDER BY PARTNER_NO DESC
	</select>
	
	<!-- 파트너 수(검색) -->
	<select id="getSerchListCountP">
		SELECT COUNT(*)
		FROM "PARTNER"
		WHERE PARTNER_ID LIKE '%' || #{search} || '%'
	</select>
	
	<!-- 파트너 목록(검색) -->
	<select id="selectSearchPartner">
		SELECT PARTNER_NO, PARTNER_ID, PARTNER_BUSINESS_NAME, PARTNER_BUSINESS_NUM,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, PARTNER_TEL, PARTNER_DEL_FL
		FROM "PARTNER"
		WHERE PARTNER_ID LIKE '%' || #{search} || '%'
		ORDER BY PARTNER_NO DESC
	</select>
	
	<!-- 파트너 수(검색+정렬) -->
	<select id="getSortSerchListCountP">
		SELECT COUNT(*)
		FROM "PARTNER"
		WHERE PARTNER_ID LIKE '%' || #{search} || '%'
		<choose>
			<!-- 정렬 N : 활동중 -->
			<when test='sort == "n"'>
				AND PARTNER_DEL_FL = 'N'
			</when>
			
			<!-- 정렬 Y: 탈퇴  -->	
			<when test='sort == "y"'>
				AND PARTNER_DEL_FL = 'Y'
			</when>
		</choose>
	</select>
	
	<!-- 파트너 목록(검색+정렬) -->
	<select id="selectSortSearchPartner">
		SELECT PARTNER_NO, PARTNER_ID, PARTNER_BUSINESS_NAME, PARTNER_BUSINESS_NUM,
		TO_CHAR(ENROLL_DATE,'YYYY-MM-DD') ENROLL_DATE, PARTNER_TEL, PARTNER_DEL_FL
		FROM "PARTNER"
		WHERE PARTNER_ID LIKE '%' || #{search} || '%'
		<choose>
			<!-- 정렬 N : 활동중 -->
			<when test='sort == "n"'>
				AND PARTNER_DEL_FL = 'N'
			</when>
			
			<!-- 정렬 Y: 탈퇴  -->	
			<when test='sort == "y"'>
				AND PARTNER_DEL_FL = 'Y'
			</when>
		</choose>
		ORDER BY PARTNER_NO DESC
	</select>
</mapper>
