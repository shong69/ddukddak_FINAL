<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ddukddak.myPage.model.mapper.CartAndWishListMapper">

	<!-- 장바구니 상품 목록 조회 장바구니아이디로 장아옵 테이블 조회 -> 조회한 옵션 아이디로 옵션테이블에서 옵션 이름 조회 + 상품 넘버로 이름, 이미지, 가격 조회  -->
	<!-- 결제 시  -->
	<select id="selectCartList">
		SELECT CART_ID, PRODUCT_NO, PRODUCT_NAME, PRODUCT_PRICE, PRODUCT_COUNT,
				UPLOAD_IMG_NO, UPLOAD_IMG_PATH, UPLOAD_IMG_OG_NAME, UPLOAD_IMG_RENAME
		FROM PRODUCT NATURAL JOIN CART NATURAL JOIN UPLOAD_FILE
		WHERE MEMBER_NO = #{memberNo}
		AND UPLOAD_IMG_ORDER = 0
		ORDER BY CART_ID
	</select>
	
	<!-- 장바구니 상품 옵션 아이디  -->
	<select id="selectCartListOptionNo">
		SELECT OPTION_NO
		FROM CARTITEM_OPTION
		WHERE CART_ID = #{cartId}
	</select>
	
	<!-- 장바구니 상품 옵션값  -->
	<select id="selectCartListOptionValue">
		SELECT OPTION_VALUE
		FROM CARTITEM_OPTION NATURAL JOIN "OPTION"
		WHERE CART_ID = #{cartId}
	</select>
	
	<!-- 장바구니 아이템 수량 수정 -->
	<update id="updateCount">
		UPDATE SET "CART"
		PRODUCT_COUNT = #{productCount}
		WHERE MEMBER_NO = #{memberNo}
		AND PRODUCT_NO = #{productNo}
	</update>
	
	<!-- 장바구니 아이템 삭제 -->
	<delete id="deleteProduct">
		DELETE FROM "CART"
		WHERE MEMBER_NO = #{memberNo}
		AND PRODUCT_NO = #{productNo}
		AND OPTION_NO = #{optionNo}
	</delete>
	
	<!-- 장바구니 상품 추가 -->
	<insert id="insertCartItem">
		INSERT INTO "CART"
		VALUES(SEQ_CART_ID.NEXTVAL,#{quantity},#{memberNo},#{productNo})
	</insert>

	
	<!-- 장바구니 상품 옵션 추가 -->
	<insert id="insertOption">
		INSERT INTO "CARTITEM_OPTION"
		VALUES(SEQ_CART_ID.CURRVAL,#{oneOption},SEQ_CARTITEM_OPTION_ID.NEXTVAL)
	</insert>
	

</mapper>
