<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ddukddak.myPage.model.mapper.CartAndWishListMapper">

	<!-- 장바구니 상품 목록 조회 장바구니아이디로 장아옵 테이블 조회 -> 조회한 옵션 아이디로 옵션테이블에서 옵션 이름 조회 + 상품 넘버로 이름, 이미지, 가격 조회  -->
	<!-- 결제 시  -->
	<select id="selectCartList">
		SELECT  C.CART_ID, C.PRODUCT_NO, P.PRODUCT_NAME, P.PRODUCT_PRICE, C.PRODUCT_COUNT,  U.PRODUCT_IMG, X.OPTION_NO, Z.OPTION_VALUE
		FROM 
		    "CART" C
		JOIN 
		    PRODUCT P ON C.PRODUCT_NO = P.PRODUCT_NO
		LEFT JOIN 
			"CARTITEM_OPTION" X ON X.CART_ID = C.CART_ID
		LEFT JOIN 
				(SELECT OPTION_VALUE, CI.OPTION_NO
				FROM "OPTION" O
				LEFT JOIN CARTITEM_OPTION CI ON CI.OPTION_NO = O.OPTION_NO) Z
				ON Z.OPTION_NO = X.OPTION_NO
		LEFT JOIN 
		    (SELECT PRODUCT_NO, UPLOAD_IMG_PATH || UPLOAD_IMG_RENAME  PRODUCT_IMG FROM UPLOAD_FILE WHERE UPLOAD_IMG_ORDER = 0) U 
		    ON U.PRODUCT_NO = P.PRODUCT_NO
		WHERE C.MEMBER_NO = #{memberNo}
		ORDER BY C.CART_ID
	</select>
	
	<!-- 장바구니 아이템 추가 -->
	<insert id="insertProduct">
		INSERT "CART"
		VALUES(어쩌구.NEXTVAL,#{productCount},#{memberNo},#{productNo},#{optionNo})
	</insert>
	
	<!-- 장바구니 아이템 수량 수정 -->
	<update id="updateCount">
		UPDATE SET "CART"
		PRODUCT_COUNT = #{productCount}
		WHERE MEMBER_NO = #{memberNo}
		AND PRODUCT_NO = #{productNo}
	</update>
	
	<!-- 장바구니 아이템 삭제 -->
	<delete id="deleteProduct">
		DELETE FROM "CART"
		WHERE MEMBER_NO = #{memberNo}
		AND PRODUCT_NO = #{productNo}
		AND OPTION_NO = #{optionNo}
	</delete>
	
	<!-- 장바구니 상품 추가 -->
	<insert id="insertCartItem">
		INSERT "CART"
		VALUES(SEQ_CART_ID.NEXTVAL,#{quantity},#{memberNo},#{productNo})
	</insert>
	

</mapper>
