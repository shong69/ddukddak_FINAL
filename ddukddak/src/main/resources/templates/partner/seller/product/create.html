<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뚝딱뚝딱 : 판매사</title>

    <link rel="stylesheet" href="/css/common/fragments/header.css">
    <link rel="stylesheet" href="/css/common/main.css">
    <link rel="stylesheet" href="/css/partner/seller/product/create.css">
    <link rel="icon" type="image/x-icon" href="/images/main/favicon.ico">
</head>
<body>
    <th:block th:replace="~{partner/seller/common/header}"></th:block>


    <div id="createContainer">
        <h1>상품관리 > 재고생성</h1>

        <!-- 검색엔진 -->
        <th:block th:replace="~{partner/seller/common/search}"></th:block>

        <!-- 상품 분류 -->
        <th:block th:replace="~{partner/seller/common/category}"></th:block>

        <!-- 상품등록버튼 -->
        <div id="sellerButton">
            <button id="productCreateButton" type="button">재고 등록</button>
            <button id="productApplyButton" type="button">판매 등록</button>
        </div>

        <div id="selectAll">
            <input type="checkbox" value="selectAll" name="select" id="selectAllCheckBox"><label>전체 선택</label>
        </div>

        <!-- 상품목록 -->
        <div id="productList">
            <table>
                <thead style="height: 60px;">
                    <td></td>
                    <td>상품</td>
                    <td>대분류</td>
                    <td>소분류</td>
                    <td>생성날짜</td>
                    <td>상품번호</td>
                    <td>상품명</td>
                    <td>판매가</td>
                    <td>상품삭제</td>
                </thead>


                <th:block th:each="createItem : ${createList}" th:object="${createItem}">
                    <tr class="borderTr">
                        <td>
                            <input type="checkbox" th:value="${createItem.productNo}" name="selectProduct">
                        </td>
                        <td><img th:src="|${createItem.uploadImgPath}${createItem.uploadImgRename}|"></td>
                        <td th:text="${createItem.bigCategoryName}">대분류</td>
                        <td th:text="${createItem.categoryName}">소분류</td>
                        <td th:text="${createItem.productCreateDate}">생성날짜</td>
                        <td th:text="${createItem.productNo}">상품번호</td>
                        <td th:text="${createItem.productName}">상품제목</td>
                        <td th:text="${createItem.productPrice}" class="productPrice">상품가격</td>
                        <td><button>삭제</button></td>
                    </tr>
                </th:block>

            </table>
        </div>

        <!-- 페이지네이션 -->
        <div><h3 style="text-align: center; margin: 30px 0;"><<&nbsp;&nbsp;<&nbsp;&nbsp;&nbsp;1&nbsp;&nbsp;&nbsp;2&nbsp;&nbsp;&nbsp;3&nbsp;&nbsp;&nbsp;4&nbsp;&nbsp;&nbsp;5&nbsp;&nbsp;&nbsp;6&nbsp;&nbsp;&nbsp;7&nbsp;&nbsp;&nbsp;8&nbsp;&nbsp;&nbsp;9&nbsp;&nbsp;&nbsp;10&nbsp;&nbsp;&nbsp;>&nbsp;&nbsp;>></h3></div>

    </div>


    <!-- 모달창 -->
    <div class="modal">
        <div id="closeButton">X</div>

        <div>
            <h2>재고 등록</h2>
        </div>


        <form action="/partner/seller/product/create" method="POST" enctype="multipart/form-data">
            <div id="createProduct">
    
                <div>
                    <label class="fileBox" for="file">
                        <h2 id="filePlus">+</h2>
                        <img id="preview" />
                        <h4 id="mainImg">대표사진</h4>
                    </label>
                    <input type="file" onchange="readMainURL(this);" class="file" id="file" accept="image/*" name="thumbnailImg">
                
                    <div id="subImgContainer">
                        <div id="subImgBox">
                        </div>
                
                        <label type="button" id="subImgPlus" for="subFile">사진추가</label>
                        <input type="file" multiple class="file" name="subImgs" id="subFile" onchange="readSubURLs(this);">
                    </div>
                </div>
                
    
                <div id="productEx">
                    <table>
                        <tr>
                            <td><h4>상품명</h4></td>
                            <td><input id="productName" name="productName"></td>
                        </tr>
                        <tr>
                            <td><h4>상품 분류</h4></td>
                            <td>
                                <select id="bigCategory">
                                    <option value="none">대분류</option>
                                    <th:block th:each="category : ${categoryList}" th:object="${category}">
                                        <option th:value="${category.bigCategoryNo}" th:text="${category.bigCategoryName}">대분류값</option>
                                    </th:block>
                                </select>
    
                                <select id="smallCategory" name="smallCategory">
                                    <option value="none">소분류</option>
                                </select>
                            </td>
                        </tr>
    
                        <tr>
                            <td><h4>판매가</h4></td>
                            <td><input id="price" name="productPrice"></td>
                        </tr>
                    </table>
    
    
                    <h4>옵션명</h4>
                    <div id="option">
                        <div id="optionBox"></div>
                        <div id="plusBox">
                            <button type="button" id="productPlusButton">+</button>
                        </div>
                    </div>
    
    
                    <div id="buttonBox"><button id="createButton">등록하기</button></div>
                </div>
    
            </div>
        
        </form>
    </div>

    <script src="/js/partner/seller/product/create.js"></script>
    <script>
        function readSubURLs(input) {
            if (input.files && input.files.length > 0) {
                const subImgBox = document.getElementById('subImgBox');
                const totalSubImages = subImgBox.children.length + input.files.length;

                if (totalSubImages > 7) {
                    alert('서브이미지는 최대 7개까지 추가할 수 있습니다.');
                    return;
                }

                Array.from(input.files).forEach(file => {
                    // 이미지 파일인지 확인
                    if (!file.type.startsWith('image/')) {
                        alert('이미지 파일만 선택할 수 있습니다.');
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const previewContainer = document.createElement('div');
                        previewContainer.classList.add('preview-image-container');

                        const preview = document.createElement('img');
                        preview.classList.add('preview-image');
                        preview.src = e.target.result;
                        previewContainer.appendChild(preview);

                        const deleteButton = document.createElement('button');
                        deleteButton.classList.add('delete-button');
                        deleteButton.textContent = 'X';
                        deleteButton.onclick = function() {
                            if(confirm("해당 사진을 삭제하시겠습니까?")) {
                                previewContainer.remove(); // 이미지 삭제
                            }
                        };
                        previewContainer.appendChild(deleteButton);

                        subImgBox.appendChild(previewContainer);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }
    </script>

    
</body>
</html>