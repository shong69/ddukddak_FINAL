<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>뚝딱뚝딱 : 쇼핑</title>

    <link rel="stylesheet" href="/css/common/fragments/header.css">
    <link rel="stylesheet" href="/css/common/fragments/footer.css">
    <link rel="stylesheet" href="/css/common/main.css">
    <link rel="stylesheet" href="/css/eCommerce/eCommerceMain.css">
    <link rel="icon" type="image/x-icon" href="/images/main/favicon.ico">

    <script src="https://kit.fontawesome.com/74d1671a70.js" crossorigin="anonymous"></script>
</head>
<body>
    <th:block th:replace="~{common/fragments/header}"></th:block>
    
    <th:block th:replace="~{eCommerce/common/searchHeader}"></th:block>

    <!-- 광고영상 -->
    <div id="ad-container">
        <iframe src="https://www.youtube.com/embed/_jgIs1bMQc4?autoplay=1&mute=1&controls=0&loop=1&playlist=_jgIs1bMQc4" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

        <div id="slide2">
            <ul>
                <li>
                    <a href="#">
                        <img src="/images/main/ad-4.jpg">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <img src="/images/main/ad-5.jpg">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <img src="/images/main/ad-6.jpg">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <img src="/images/main/ad-7.jpg">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <img src="/images/main/ad-8.jpg">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <img src="/images/main/ad-9.jpg">
                    </a>
                </li>
                <li>
                    <a href="#">
                        <img src="/images/main/ad-10.jpg">
                    </a>
                </li>
            </ul>
        </div>
    </div>


    <!-- 쇼핑 카테고리 -->
    <div style="margin-left: 30px;"><h4>카테고리별 상품보기</h4></div>
    <th:block th:replace="~{eCommerce/common/category}"></th:block>


    <!-- 쇼핑 목록 -->
    <div class="shoping-list" style="margin-top: 100px;">
        <div>
          <h3 style="font-weight: bold;">오늘의 상품</h3>
        </div>

        <div style="margin-bottom: 10px;">
          <h4 style="cursor: pointer;" onclick="location.href='/eCommerce/list/1/1';">+ 더보기</h4>
        </div>

        <!-- 쇼핑 아이템들 -->
        <div class="shopping-items">
          <div th:each="productList : ${selectProductList}" th:object="${productList}">
            <a th:href="@{'/eCommerce/list/' + *{bigCategoryNo} + '/' + *{categoryNo} + '/' + *{productNo} + '/detail'}">
              <div class="img-wrap">
                <div>
                  <img th:src="|*{uploadImgPath}*{uploadImgRename}|">
                </div>

                <i th:data-memberNo="${loginMember.memberNo}" th:if="${loginMember != null}"
                    th:style="*{wish == 0} ? 'display:block;' : 'display:none;'"
                    class="fa-regular fa-heart" id="noHerat" onclick="showHert(event);"
                    th:value="*{productNo}">
                </i>
                <i th:data-memberNo="${loginMember.memberNo}" th:if="${loginMember != null}"
                    th:style="*{wish == 0} ? 'display:none;' : 'display:block;'"
                    class="fa-solid fa-heart" id="heart" onclick="noshowHert(event);"
                    th:value="*{productNo}">
                </i>
                <h5 class="sample"></h5>
              </div>
              <div class="title-wrap">
                <h4 th:text="*{productName}">상품제목</h4>
              </div>
              <div class="price-wrap">
                <h3>32%</h3>
                <h3 th:text="*{productPrice} + '원'" class="productPrice">상품가격</h3>
              </div>
              <div class="review-wrap">
                <img src="/images/main/star.png">
                <h5>4.1</h5>
                <h5>리뷰 78개</h5>
              </div>
            </a>
          </div>
        </div>
    </div>

    <!-- 베스트 -->
    <div class="shoping-list" id="bestContainer" style="margin-top: 150px;">
        <div>
          <h3 style="font-weight: bold; margin-right: 30px;">베스트</h3>
          <div th:each="category : ${categoryList}" th:object="${category}">
            <h4 th:text="${category.bigCategoryName}" th:value="${category.bigCategoryNo}" class="selectBest">대분류</h4>
          </div>
        </div>

        <div style="margin-bottom: 10px;">
          <a id="plusProduct" href="/eCommerce/list/1/1">+ 더보기</a>
        </div>

        <!-- 쇼핑 아이템들 -->
        <div class="shopping-items" style="margin-bottom: 200px;" id="best-items">
          <div th:each="productBestList : ${selectBestProductList}" th:object="${productBestList}">
            <a th:href="@{'/eCommerce/list/' + *{bigCategoryNo} + '/' + *{categoryNo} + '/' + *{productNo} + '/detail'}">
              <div class="img-wrap">
                <div>
                  <img th:src="|*{uploadImgPath}*{uploadImgRename}|">
                </div>

                <i th:data-memberNo="${loginMember.memberNo}" th:if="${loginMember != null}"
                    th:style="*{wish == 0} ? 'display:block;' : 'display:none;'"
                    class="fa-regular fa-heart" id="noHerat" onclick="showHert(event);"
                    th:value="*{productNo}">
                </i>
                <i th:data-memberNo="${loginMember.memberNo}" th:if="${loginMember != null}"
                    th:style="*{wish == 0} ? 'display:none;' : 'display:block;'"
                    class="fa-solid fa-heart" id="heart" onclick="noshowHert(event);"
                    th:value="*{productNo}">
                </i>
              </div>
              <div class="title-wrap">
                <h4 th:text="*{productName}">상품제목</h4>
              </div>
              <div class="price-wrap">
                <h3>32%</h3>
                <h3 th:text="*{productPrice} + '원'" class="productPrice">상품가격</h3>
              </div>
              <div class="review-wrap">
                <img src="/images/main/star.png">
                <h5>4.1</h5>
                <h5>리뷰 78개</h5>
              </div>
            </a>
          </div>
        </div>
    </div>


    <th:block th:replace="~{common/fragments/footer}"></th:block>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="/js/eCommerce/eCommerce.js"></script>
    <script src="/js/common/redirectToLogin.js"></script>

    <script th:inline="javascript">
        
      // 찜하기 눌렀을 때
      function showHert(event) {
          event.preventDefault();


          event.target.style.display = 'none';
          event.target.nextElementSibling.style.display = 'block';
          

          var obj = {
              "memberNo" : event.target.attributes[0].value,
              "productNo" : event.target.attributes[5].value
          }


          fetch("/myPage/addWish", {
              method : "PUT",
              headers : {"Content-Type": "application/json"},
              body : JSON.stringify(obj)
          })
          .then(resp => resp.text())
          .then(temp => {
            if(temp > 0) {
                    alert("위시리스트에 추가되었습니다");
                }else {
                    alert("위시리스트 추가 실패");
                }
          });



          return false;
      }
      function noshowHert(event) {
          event.preventDefault();

          event.target.style.display = 'none';
          event.target.previousElementSibling.style.display = 'block';


          var obj = {
              "memberNo" : event.target.attributes[0].value,
              "productNo" : event.target.attributes[5].value
          }

          console.log(event.target.attributes);


          fetch("/myPage/delWish", {
              method : "POST",
              headers : {"Content-Type": "application/json"},
              body : JSON.stringify(obj)
          })
          .then(resp => resp.text())
          .then(temp => {
            if(temp > 0) {
                    alert("위시리스트에서 삭제되었습니다");
                }else {
                    alert("위시리스트 삭제 실패");
                }
          });


          return false;
      }
  </script>
</body>
</html>